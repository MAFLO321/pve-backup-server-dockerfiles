From 6d032d7dd797abfa847a8ebf0e71640b7edbfa72 Mon Sep 17 00:00:00 2001
From: Matthias Freund <matthias88freund@gmail.com>
Date: Thu, 9 Sep 2021 22:52:14 +0200
Subject: [PATCH] Cargo config

---
 Cargo.toml          | 2 +-
 debian/cargo_config | 2 ++
 debian/compat       | 1 +
 debian/docs         | 1 -
 debian/rules        | 7 +++++++
 5 files changed, 11 insertions(+), 2 deletions(-)
 create mode 100644 debian/cargo_config
 create mode 100644 debian/compat
 delete mode 100644 debian/docs

diff --git a/Cargo.toml b/Cargo.toml
index ffd72b2..80ba2c8 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -14,4 +14,4 @@ exclude = [ "build", "debian" ]
 mio = { version = "0.7", features = [ "net", "os-ext" ] }
 curl = "0.4"
 clap = "2.33"
-proxmox = { version = "0.10.0", default-features = false }
+proxmox = { path = "../proxmox/proxmox", default-features = false }
diff --git a/debian/cargo_config b/debian/cargo_config
new file mode 100644
index 0000000..38bd089
--- /dev/null
+++ b/debian/cargo_config
@@ -0,0 +1,2 @@
+[build]
+rustflags = []
diff --git a/debian/compat b/debian/compat
new file mode 100644
index 0000000..48082f7
--- /dev/null
+++ b/debian/compat
@@ -0,0 +1 @@
+12
diff --git a/debian/docs b/debian/docs
deleted file mode 100644
index 8696672..0000000
--- a/debian/docs
+++ /dev/null
@@ -1 +0,0 @@
-debian/SOURCE
diff --git a/debian/rules b/debian/rules
index 2b62edd..2047402 100755
--- a/debian/rules
+++ b/debian/rules
@@ -3,6 +3,13 @@
 %:
 	dh $@ --buildsystem cargo
 
+override_dh_auto_test:
+	# ignore here to avoid rebuilding the binaries with the wrong target
+
+override_dh_auto_configure:
+	mkdir -p debian/cargo_home/
+	cp -av debian/cargo_config debian/cargo_home/config
+
 override_dh_auto_build:
 	dh_auto_build
 	sed -e 's/@VERSION@/${VERSION}/' src/www/index.html.tpl.in > src/www/index.html.tpl
-- 
2.33.0

